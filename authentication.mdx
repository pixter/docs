---
title: "Autentica√ß√£o"
description: "Autentica√ß√£o com Auth0 usando Custom Database + API Sinerlog"
sidebarTitle: "Autentica√ß√£o"
---

## üß≠  Vis√£o Geral

Este sistema de autentica√ß√£o combina a robustez do Auth0 com a l√≥gica de neg√≥cio da Sinerlog, permitindo validar e autorizar usu√°rios de maneira segura, escal√°vel e integrada.\
O processo √© centralizado: todas as autentica√ß√µes passam pelo Auth0, mas a valida√ß√£o real do login √© feita via API privada da Sinerlog.

---

## üß©  Componentes envolvidos

| Componente                   | Fun√ß√£o                                                                    |
| ---------------------------- | ------------------------------------------------------------------------- |
| **Auth0**                    | Fornece camada de identidade, sess√£o, regras e tokens JWT                 |
| **Custom Database Script**   | Permite que Auth0 delegue a valida√ß√£o de credenciais para uma API externa |
| **API da Sinerlog**          | Respons√°vel por autenticar e retornar o perfil do usu√°rio                 |
| **Frontend (React/Next.js)** | Consome o token JWT e acessa os claims do usu√°rio                         |
| **Actions (Auth0)**          | Enriquecem o `idToken` com informa√ß√µes extras vindas da API               |

---

## üîê  Etapas detalhadas do processo de login

### 1. Acesso ao login

- O usu√°rio acessa o frontend e √© redirecionado para o Universal Login do Auth0.
- Ele preenche o `email` e a `senha`.

---

### 2. Execu√ß√£o do script `login()` (Custom Database)

- O Auth0 executa o script de autentica√ß√£o customizada com o seguinte fluxo:

```js
const passwordBase64 = Buffer.from(password, 'utf-8').toString('base64');

axios.post('https://sinerlog-identity-backend.dev.sinerlog.log.br/api/User/authorize', {
  email: email,
  password: passwordBase64,
  applicationId: 1
})
```

- A API da Sinerlog responde com o status do login e os dados completos do usu√°rio (ID, roles, contas, permiss√µes, etc.).
- O script `login()` retorna um `user_profile` para o Auth0 com todos os dados que ser√£o usados posteriormente.

---

### 3. Enriquecimento do `idToken` (Action Post Login)

- Ap√≥s a autentica√ß√£o, uma **Action** captura o `user_profile` e adiciona claims personalizados ao `idToken`:

```js
api.idToken.setCustomClaim('https://sinerlog.app/claims', {
  id: user.user_id,
  email: user.email,
  name: user.name,
  roles: user.roles,
  applications: user.applications,
  accounts: user.accounts,
  superAdmin: user.superAdmin,
  active: user.active
});
```

Esses dados ficam dispon√≠veis para o frontend usar diretamente.

---

### 4. Redirecionamento e cria√ß√£o de sess√£o

- O Auth0 gera um `idToken` e um `accessToken` e redireciona o usu√°rio de volta para o frontend.
- O frontend salva a sess√£o em mem√≥ria (ou com cookies/sess√£o persistente, dependendo da config).

---

### 5. Valida√ß√£o cont√≠nua da sess√£o

A cada p√°gina visitada:

- O frontend chama `auth0.getUser()` para recuperar os claims.
- Caso o token esteja expirado, o SDK tenta **silent login** para renova√ß√£o autom√°tica.
- Se falhar, o usu√°rio √© redirecionado para o login novamente.

---

## üõ°Ô∏è  Seguran√ßa e Garantias

- ‚úÖ A senha nunca √© armazenada ou processada no Auth0, apenas repassada para a API (via HTTPS).
- ‚úÖ O token gerado √© assinado com RS256 e validado em todas as chamadas do frontend/backend.
- ‚úÖ Sess√µes curtas com silent login evitam login repetitivo mas garantem controle.
- ‚úÖ Roles, permiss√µes e contas ficam embutidas no token e n√£o podem ser manipuladas no client.

---

## üß† Exemplo completo de token JWT decodificado

```json
{
  "email": "usuario@dominio.com.br",
  "name": "Nome do cliente",
  "https://sinerlog.app/claims": {
    "roles": ["Administrator"],
    "accounts": [{ "id": 5, "name": "Master" }],
    "applications": [{ "id": 1, "name": "Sinerlog Central" }],
    "superAdmin": true,
    "active": true
  },
  "exp": 1723562399,
  "iat": 1723558799,
  "sub": "auth0|abc123xyz"
}
```

---

## üß™  Testes e fallback

- O script de login foi projetado para falhar com `WrongUsernameOrPasswordError` caso a API retorne erro.
- Caso a API esteja fora do ar, o login n√£o √© autorizado.
- Os dados do usu√°rio s√≥ s√£o atualizados no Auth0 em cada novo login.

---

## üìö  Poss√≠veis extens√µes futuras

- Atualiza√ß√£o do perfil via Action (para sync de dados)
- Implementar MFA no Auth0 (Auth0 Guardian)
- Adi√ß√£o de refresh token \+ rota de revoga√ß√£o
- Envio de webhooks de login para monitoramento

---

## ‚úÖ  Checklist de boas pr√°ticas aplicadas

- Tokens curtos e seguros (RS256)
- Claims customizados via Action
- Valida√ß√£o cont√≠nua da sess√£o
- Centraliza√ß√£o total via API da Sinerlog
- Separa√ß√£o de responsabilidades: Auth0 = identidade, API = l√≥gica